<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë§ˆíŠ¸ ì¶œì„ë¶€</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Noto+Serif+KR:wght@700&display=swap" rel="stylesheet">
    <style>
        /* [ê¸°ë³¸ ì„¤ì •] */
        * { box-sizing: border-box; }
        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            background-color: #f4f6f9; 
            display: flex; flex-direction: column; align-items: center; 
            padding: 40px 20px; min-height: 100vh; margin: 0;
        }

        /* í™ˆ ë²„íŠ¼ */
        .home-btn {
            position: fixed; top: 20px; left: 20px; width: 50px; height: 50px;
            background-color: #0b2a4a; color: white; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            text-decoration: none; box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            font-size: 24px; z-index: 9999;
        }

        /* ì…ë ¥ íŒ¨ë„ (ì»¨íŠ¸ë¡¤ ë°•ìŠ¤) */
        .input-panel {
            background: white; padding: 30px; border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            max-width: 900px; width: 100%;
            margin-bottom: 50px; text-align: center; border-top: 5px solid #0b2a4a;
        }

        /* ì…ë ¥ í¼ ë””ìì¸ */
        .info-row { display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
        .info-input { 
            padding: 12px; border: 1px solid #dee2e6; border-radius: 5px; 
            font-size: 1rem; flex: 1; min-width: 150px;
        }
        textarea {
            width: 100%; height: 150px; padding: 15px; 
            border: 2px solid #ced4da; border-radius: 10px;
            font-size: 1.1rem; line-height: 1.8; font-family: monospace;
            background-color: #fff; margin-bottom: 15px;
        }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-group { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
        .btn {
            padding: 12px 20px; border: none; border-radius: 8px; 
            font-size: 1rem; font-weight: bold; cursor: pointer; transition: 0.2s;
            color: white; flex: 1; min-width: 120px;
        }
        .btn-gen { background-color: #0b2a4a; flex: 2; } 
        .btn-gen:hover { background-color: #1a3b5c; }
        .btn-add-blank { background-color: #1098ad; } 
        .btn-print { background-color: #495057; } 
        .btn-clear { background-color: #fa5252; max-width: 100px; } 

        /* [í•µì‹¬] A4 ìš©ì§€ ìŠ¤íƒ€ì¼ */
        .sheet {
            background: white; 
            width: 210mm; 
            height: 297mm; /* A4 ë†’ì´ ê³ ì • */
            padding: 20mm;
            margin-bottom: 30px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            border: 1px solid #dce0e3; 
            display: flex; 
            flex-direction: column;
            position: relative;
        }

        /* í˜ì´ì§€ ë²ˆí˜¸ */
        .page-num {
            position: absolute; bottom: 10mm; left: 0; width: 100%;
            text-align: center; font-size: 12px; color: #888;
        }

        /* ì‚­ì œ ë²„íŠ¼ */
        .row-del-btn {
            background: #ffc9c9; border: 1px solid #fa5252; cursor: pointer; color: #c92a2a;
            font-weight: bold; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;
            white-space: nowrap; 
        }
        .row-del-btn:hover { background: #fa5252; color: white; }

        /* [ì¸ì‡„ ì‹œ ì ìš© ìŠ¤íƒ€ì¼] */
        @page { size: A4; margin: 0; }
        @media print {
            body { background: white; padding: 0; }
            .input-panel, .home-btn { display: none !important; } 
            .sheet { 
                margin: 0; box-shadow: none; border: none;
                page-break-after: always; 
            }
            .no-print { display: none !important; } 
        }

        /* í‘œ ë””ìì¸ */
        .doc-header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 15px; }
        .doc-title { font-family: 'Noto Serif KR', serif; font-size: 2.2rem; font-weight: bold; margin-bottom: 10px; }
        .doc-meta { 
            display: flex; justify-content: space-between; font-size: 1.1rem; 
            margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px; 
        }
        
        .roster-table { width: 100%; border-collapse: collapse; margin-top: 5px; table-layout: fixed; }
        .roster-table th, .roster-table td { border: 1px solid #333; padding: 6px 5px; text-align: center; vertical-align: middle; }
        .roster-table th { background-color: #f1f3f5; height: 35px; font-weight: bold; font-size: 1rem; }
        .roster-table td { height: 40px; font-size: 1rem; }
        
        /* ì»¬ëŸ¼ ë„ˆë¹„ ì¡°ì • */
        .col-del { width: 60px; } 
        .col-no { width: 40px; }
        .col-dept { width: 160px; }
        .col-id { width: 110px; }
        .col-name { width: 100px; }
        .col-sign { } 

        /* ì¶œë ¥ ì˜ì—­ ì»¨í…Œì´ë„ˆ */
        #outputContainer { display: none; flex-direction: column; align-items: center; width: 100%; }

    </style>
</head>
<body>

    <a href="index.html" class="home-btn">ğŸ </a>

    <div class="input-panel">
        <h2 style="margin-bottom:15px; color:#0b2a4a;">âœï¸ ìŠ¤ë§ˆíŠ¸ ì¶œì„ë¶€</h2>
        
        <p style="text-align:left; background:#e7f5ff; padding:15px; border-radius:10px; margin-bottom:20px; color:#084298;">
            <strong>[1. ì…ë ¥]</strong> í–‰ì‚¬ ì •ë³´ì™€ ëª…ë‹¨ì„ ì…ë ¥í•˜ì„¸ìš”.<br>
            â€» íƒ€ê³¼ìƒì€ í•™ê³¼ëª…ì„ ê°™ì´ ì ìœ¼ì„¸ìš”. (ì˜ˆ: <strong>ê²½ì˜í•™ê³¼</strong> 20240001 í™ê¸¸ë™)<br>
            â€» í•˜ë‹¨ì— <strong>A4 ìš©ì§€ ëª¨ì–‘</strong>ìœ¼ë¡œ ë¯¸ë¦¬ë³´ê¸°ê°€ ìƒì„±ë©ë‹ˆë‹¤.<br>
            <strong>[2. ì¸ì‡„]</strong> 'ëª…ë‹¨ ì ìš©' í›„ 'ì¸ì‡„í•˜ê¸°'ë¥¼ ëˆ„ë¥´ì„¸ìš”.
        </p>

        <div class="info-row">
            <input type="text" id="eventName" class="info-input" placeholder="í–‰ì‚¬ëª… (ì˜ˆ: ì´ë€ì–´ê³¼ ë§í•˜ê¸° ëŒ€íšŒ)">
            <input type="text" id="eventDate" class="info-input" placeholder="ì¼ì‹œ">
            <input type="text" id="eventPlace" class="info-input" placeholder="ì¥ì†Œ (ì˜ˆ: ë³¸ê´€ 320í˜¸)">
        </div>

        <textarea id="inputText" placeholder="ëª…ë‹¨ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 20260001 ê¹€ì² ìˆ˜)"></textarea>

        <div class="btn-group">
            <button class="btn btn-clear" onclick="clearText()">ì´ˆê¸°í™”</button>
            <button class="btn btn-gen" onclick="parseAndRender()">ğŸ”„ 1. ëª…ë‹¨ ì ìš© (A4 ìƒì„±)</button>
            <button class="btn btn-add-blank" onclick="addBlankData(5)">â• 2. ë¹ˆì¹¸ 5ì¤„ ì¶”ê°€</button>
        </div>
        
        <div class="btn-group" style="margin-top: 15px; border-top: 1px dashed #ced4da; padding-top: 15px;">
            <button class="btn btn-print" onclick="printPage()">ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°</button>
        </div>
    </div>

    <div id="outputContainer"></div>

    <script>
        // í•œ í˜ì´ì§€ë‹¹ ì¤„ ìˆ˜ 20ëª…
        const ROWS_PER_PAGE = 20;

        let globalDataList = [];

        window.onload = function() {
            const today = new Date();
            const dateStr = `${today.getFullYear()}.${today.getMonth()+1}.${today.getDate()}`;
            document.getElementById('eventDate').value = dateStr;
        };

        // [ìˆ˜ì •] ì¸ì‡„ ì§ì „ì—ë§Œ ì œëª©ì„ ë°”ê¾¸ëŠ” í•¨ìˆ˜
        function printPage() {
            const eventName = document.getElementById('eventName').value.trim();
            if(eventName) {
                // í–‰ì‚¬ëª…ì´ ìˆìœ¼ë©´ ì ì‹œ ë¬¸ì„œ ì œëª©ì„ ë°”ê¿ˆ (íŒŒì¼ëª…ì„ ìœ„í•´)
                document.title = eventName;
            } else {
                document.title = "ìŠ¤ë§ˆíŠ¸ ì¶œì„ë¶€";
            }
            window.print();
        }

        // [1] í…ìŠ¤íŠ¸ -> ë°ì´í„° íŒŒì‹± í›„ ê·¸ë¦¬ê¸°
        function parseAndRender() {
            const raw = document.getElementById('inputText').value;
            globalDataList = []; // ì´ˆê¸°í™”

            if(raw.trim()) {
                const lines = raw.split('\n');
                lines.forEach(line => {
                    if(!line.trim()) return;
                    
                    let dept = "í˜ë¥´ì‹œì•„ì–´Â·ì´ë€í•™ê³¼"; 
                    let id = "";
                    let name = "";
                    let tempLine = line;

                    // í•™ë²ˆ ì¶”ì¶œ
                    const idMatch = tempLine.match(/\d{5,}/);
                    if(idMatch) {
                        id = idMatch[0];
                        tempLine = tempLine.replace(id, ""); 
                    }

                    // í•™ê³¼ëª… ì¶”ì¶œ
                    const deptMatch = tempLine.match(/[ê°€-í£]+(í•™ê³¼|ì–´ê³¼|ì „ê³µ)/);
                    if(deptMatch) {
                        dept = deptMatch[0];
                        tempLine = tempLine.replace(dept, ""); 
                    }

                    // ì´ë¦„ ì¶”ì¶œ
                    const nameMatch = tempLine.match(/[ê°€-í£a-zA-Z]+/);
                    if(nameMatch) {
                        name = nameMatch[0];
                    }

                    if(!id && !name) name = line.trim();

                    globalDataList.push({ dept, id, name });
                });
            }
            
            renderPages(); // í™”ë©´ì— ê·¸ë¦¬ê¸°
        }

        // [2] ë¹ˆì¹¸ ë°ì´í„° ì¶”ê°€
        function addBlankData(count) {
            for(let i=0; i<count; i++) {
                // í•™ê³¼ë„ ê³µë€ìœ¼ë¡œ ì¶”ê°€
                globalDataList.push({ dept: "", id: "", name: "" });
            }
            renderPages(); 
        }

        // [3] ë°ì´í„° ì‚­ì œ
        function deleteItem(index) {
            globalDataList.splice(index, 1); 
            renderPages(); 
        }

        // í˜ì´ì§€(A4) ë Œë”ë§ í•¨ìˆ˜
        function renderPages() {
            const container = document.getElementById('outputContainer');
            container.innerHTML = "";
            container.style.display = 'flex';

            const title = document.getElementById('eventName').value || "í–‰ì‚¬ ì¶œì„ë¶€";
            const date = document.getElementById('eventDate').value;
            const place = document.getElementById('eventPlace').value;

            // í˜ì´ì§€ ìˆ˜ ê³„ì‚°
            const totalPages = Math.ceil(globalDataList.length / ROWS_PER_PAGE) || 1;

            for (let page = 0; page < totalPages; page++) {
                const start = page * ROWS_PER_PAGE;
                const end = start + ROWS_PER_PAGE;
                const pageData = globalDataList.slice(start, end);

                const sheet = document.createElement('div');
                sheet.className = 'sheet';

                // í—¤ë” ìƒì„±
                let headerHTML = "";
                if (page === 0) {
                    headerHTML = `
                        <div class="doc-header">
                            <div class="doc-title">${title}</div>
                            <div class="doc-meta">
                                <span>ì¼ì‹œ: ${date}</span>
                                <span>ì¥ì†Œ: ${place}</span>
                            </div>
                        </div>`;
                } else {
                    headerHTML = `
                        <div class="doc-header" style="border-bottom:1px solid #ccc; padding-bottom:5px; margin-bottom:10px;">
                            <div class="doc-title" style="font-size:1.2rem;">${title} (ê³„ì†)</div>
                        </div>`;
                }

                // í…Œì´ë¸” ìƒì„±
                let rowsHTML = "";
                pageData.forEach((item, idx) => {
                    const realIndex = start + idx; 
                    rowsHTML += `
                        <tr>
                            <td class="no-print">
                                <button class="row-del-btn" onclick="deleteItem(${realIndex})">ì‚­ì œ</button>
                            </td>
                            <td>${realIndex + 1}</td>
                            <td>${item.dept}</td>
                            <td>${item.id}</td>
                            <td style="font-weight:bold;">${item.name}</td>
                            <td></td>
                        </tr>
                    `;
                });

                sheet.innerHTML = `
                    ${headerHTML}
                    <table class="roster-table">
                        <thead>
                            <tr>
                                <th class="col-del no-print">ê´€ë¦¬</th> 
                                <th class="col-no">No</th>
                                <th class="col-dept">í•™ê³¼/ì „ê³µ</th>
                                <th class="col-id">í•™ë²ˆ</th>
                                <th class="col-name">ì„±ëª…</th>
                                <th class="col-sign">ì„œëª…</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${rowsHTML}
                        </tbody>
                    </table>
                    <div class="page-num">- ${page + 1} / ${totalPages} -</div>
                `;

                container.appendChild(sheet);
            }
        }

        // ì´ˆê¸°í™”
        function clearText() {
            if(confirm('ëª¨ë“  ì…ë ¥ ë‚´ìš©ì„ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                document.getElementById('inputText').value = '';
                document.getElementById('eventName').value = '';
                document.getElementById('eventPlace').value = '';
                
                // [ìˆ˜ì •] ì œëª©ë„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”
                document.title = "ìŠ¤ë§ˆíŠ¸ ì¶œì„ë¶€";
                
                globalDataList = [];
                renderPages();
                
                // í™”ë©´ ì´ˆê¸°í™” ì‹œ ê²°ê³¼ì°½ ìˆ¨ê¹€
                document.getElementById('outputContainer').style.display = 'none';
            }
        }
    </script>
</body>
</html>